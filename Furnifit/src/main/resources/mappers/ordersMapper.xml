<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
                        
<mapper namespace="com.furnifit.orders.dao.OrdersDao">
	
	<!-- 주문 생성 -->
	<insert id="create" parameterType="Orders">
		<selectKey keyProperty="orderId" resultType="int" order="BEFORE">
			select orders_seq.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO orders
				    (order_id,
					 email,
					 price)
		VALUES 		(#{orderId},
					 #{email},
					 #{price})
	</insert>
	
	<!-- 회원별 주문할 리스트 -->
	<select id="listAll" parameterType="String" resultType="Orders">
		SELECT order_id AS "orderId",
			   email,
			   price,
			   regdate
		FROM   orders
		WHERE  email = #{email}
	</select>
	
	<!-- 게시글 리스트(+페이징) -->
	<select id="listPage" resultType="Orders">
		SELECT order_id AS "orderId",
			   email,
			   price,
			   TO_CHAR(regdate, 'YYYY-MM-DD') regdate
		FROM   (SELECT CEIL(rownum / 10) request_page,
							order_id,
			   				email,
			   				price,
							regdate
							FROM   (SELECT order_id,
						   				   email,
						   				   price,
										   regdate
								    FROM      orders
								    ORDER BY  order_id DESC))
		WHERE   request_page = #{page}
	</select>
	
	
	<!--  -->
	<select id="price" parameterType="int" resultType="Orders">
		SELECT order_id AS "orderId",
			   email,
			   price,
			   regdate
		FROM   orders
		WHERE  order_id = #{value}
	</select>
	
</mapper>

